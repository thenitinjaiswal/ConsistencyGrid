generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(cuid())
  name        String?
  email       String   @unique
  password    String?  // Hashed password for credentials auth
  image       String?
  publicToken String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  settings  WallpaperSettings?
  habits    Habit[]
  habitLogs HabitLog[]
  reminders Reminder[]
}

model WallpaperSettings {
  id     String   @id @default(cuid())
  userId String   @unique
  dob    DateTime

  lifeExpectancyYears Int @default(80)

  theme  String @default("dark-minimal")
  width  Int    @default(1080)
  height Int    @default(2400)

  showLifeGrid Boolean @default(true)
  showYearGrid Boolean @default(true)
  showAgeStats Boolean @default(true)

  showQuote Boolean @default(false)
  quote     String?

  goalEnabled      Boolean   @default(false)
  goalTitle        String?
  goalStartDate    DateTime?
  goalDurationDays Int?
  goalUnit         String?
  
  // ✅ New Layout Fields
  yearGridMode   String  @default("weeks") // "weeks" or "days"
  wallpaperType  String  @default("lockscreen") // "lockscreen", "homescreen", "calendar"
  
  showMissedDays Boolean @default(false)
  showHabitLayer Boolean @default(false)
  showLegend     Boolean @default(false)

  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Habit {
  id            String   @id @default(cuid())
  userId        String
  title         String
  scheduledTime String?  // e.g., "09:00 AM", "2:30 PM"
  isActive      Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  logs HabitLog[]
}

model HabitLog {
  id      String @id @default(cuid())
  habitId String
  userId  String

  date DateTime // "YYYY-MM-DD" like
  done Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  habit Habit @relation(fields: [habitId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ✅ Intelligent Reminder System
// This model enables reminders to live on the timeline, not just notify
model Reminder {
  id     String @id @default(cuid())
  userId String

  // Basic Info
  title       String
  description String?

  // Flexible Duration Support
  startDate DateTime // Start date of the reminder
  endDate   DateTime // End date (same as startDate for single-day reminders)

  // Time Range (optional - for non-full-day reminders)
  startTime String? // e.g., "09:00" (24-hour format)
  endTime   String? // e.g., "17:00" (24-hour format)
  isFullDay Boolean @default(true) // If true, reminder is active all day

  // Visual Presence on Grid
  markerType  String @default("dot") // "dot", "border", "fill", "badge"
  markerColor String @default("#ff7a00") // Hex color for the marker
  markerIcon  String? // Optional emoji or icon identifier

  // Priority & Importance
  priority Int @default(1) // 1=low, 2=medium, 3=high, 4=critical
  isImportant Boolean @default(false) // Marks as "Important Day"

  // Notification Behavior
  enableNotifications Boolean @default(true)
  notifyOnStart       Boolean @default(true) // Notify when reminder period starts
  notifyDaily         Boolean @default(false) // For multi-day reminders, notify each day

  // Recurrence (future feature)
  isRecurring    Boolean @default(false)
  recurrenceRule String? // e.g., "DAILY", "WEEKLY", "MONTHLY"

  // Metadata
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, startDate])
  @@index([userId, endDate])
}
